### 32. Longest Valid Parentheses

**Dynamic Programming**, **String**    [â¤ï¸](https://leetcode.com/problems/longest-valid-parentheses)    	[ðŸ’¡](https://leetcode.com/articles/longest-valid-parentheses)

#### Description

Given a string containing just the characters `'('` and `')'`, find the length of the longest valid (well-formed) parentheses substring.

**Example 1:**

```
Input: "(()"
Output: 2
Explanation: The longest valid parentheses substring is "()"
```

**Example 2:**

```
Input: ")()())"
Output: 4
Explanation: The longest valid parentheses substring is "()()"
```

#### Analysis

é¢˜æ„ï¼š ä¸€ä¸ªå­—ç¬¦ä¸²é‡Œé¢æœ‰æ•ˆçš„ `()` æœ€é•¿å­ä¸²é•¿åº¦ã€‚

åŠ¨æ€è§„åˆ’é—®é¢˜ã€‚

å®šä¹‰ `dp(i)` ä¸º `s[:i+1]` å­—ç¬¦ä¸²ä¸­æœ€é•¿æ‹¬å·ç»“æž„çš„ é•¿åº¦ï¼ˆæœ€ä¼˜è§£ï¼‰ï¼Œ æœ€ä¼˜è§£æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š

- `s(i) == '('` , `dp(i) = 0`
- `s(i) == ')'`
    - `s(i-1) == '('`,  `dp(i) = dp(i-2) + 2`
    - `s(i-1) == ')'`
        - `s(i-1-dp(i-1)) == '('`, `dp(i) = dp(i-1) + 2 + dp(i-2-dp(i-1))`
        - `s(i-1-dp(i-1)) == ')'`, `dp(i) = 0`

#### Solution1

```python
class Solution:
    def longestValidParentheses(self, s):
        """
        :type s: str
        :rtype: int
        """
        dp = [0] * len(s)
        maxlen = 0
        for i in range(1, len(s)):
            if s[i] == ')':
                if s[i-1] == '(':
                    dp[i] = dp[i-2] + 2
                elif i > dp[i-1] and s[i-1-dp[i-1]] == '(':
                    dp[i] = dp[i-1] + 2 + dp[i-2-dp[i-1]]
            print(i, dp[i], s[i], s[i-1-dp[i-1]])
            maxlen = max(maxlen, dp[i])

        return maxlen

# Solution().longestValidParentheses(')()())')
Solution().longestValidParentheses("(()))())(")
```


#### Solution2

ä¸Šé¢æ˜¯å…¸åž‹çš„DPåšæ³•ã€‚è¿˜æœ‰æ›´å·§å¦™çš„åŠžæ³•ã€‚

å…¶å®žè¿™ä¸ªæ‹¬å·ç»“æž„æœ‰ç‚¹ç‰¹æ®Šã€‚ä»”ç»†çœ‹ä¼šå‘çŽ°ï¼Œå®ƒçš„æ¨¡å¼å°±æ˜¯ï¼š

```
expr = '()' |  '(' + expr + ')' | expr + expr
```

é™¤åŽ»æœ€åŽçš„ `expr + expr`ï¼Œ  `expr` æ€»æ˜¯å¯¹ç§°çš„ã€‚

ä¸€ç§æƒ³æ³•æ˜¯ï¼Œä»Žå·¦å‘å³scanä¸€éï¼Œ å¯¹ `(` å’Œ `)` è®¡æ•°ï¼Œ å¦‚æžœ`)`çš„æ•°é‡è¶…è¿‡äº† `(`çš„æ•°é‡ï¼Œè¯´æ˜Žä¸æ˜¯æœ‰æ•ˆç»“æž„ï¼Œé‡ç½®è®¡æ•°ï¼› å¦‚æžœ `)` çš„æ•°é‡å°äºŽ `(` çš„æ•°é‡ï¼Œåˆ™è¯´æ˜Žè¿˜æœ‰ä¸€äº›æ‹¬å·éœ€è¦ä¸å…¨ï¼› å¦‚æžœäºŒè€…ç›¸ç­‰ï¼Œåˆ™è¯´æ˜Žç»“æž„åˆç†ã€‚

å¦‚æžœ `(` çš„æ•°é‡æ€»æ˜¯è¶…è¿‡ `)`ï¼Œ ä»Žå³å‘å·¦scanä¸€éï¼Œå°±å¯ä»¥è§£å†³é—®é¢˜ã€‚

```python
class Solution:
    def longestValidParentheses(self, s):
        """
        :type s: str
        :rtype: int
        """
        maxlen = 0
        left = right = 0
        for c in s:
            if c == '(':
                left += 1
            else:
                right += 1
            if left == right:
                maxlen = max(maxlen, right * 2)
            elif right > left:
                left = right = 0
        left = right = 0
        for c in s[::-1]:
            if c == '(':
                left += 1
            else:
                right += 1

            if left == right:
                maxlen = max(maxlen, right * 2)
            elif left > right:
                left = right = 0
        return maxlen
# Solution().longestValidParentheses(')()())')
Solution().longestValidParentheses("(()))())(")
```

#### [Code](../python/32.%20Longest%20Valid%20Parentheses.py)
