### 42. Trapping Rain Water

**Two Pointers**, **Array**, **Stack**    [â¤ï¸](https://leetcode.com/problems/trapping-rain-water)    	[ğŸ’¡](https://leetcode.com/articles/trapping-rain-water)

#### Description

Given _n_ non-negative integers representing an elevation map where the width of each bar is 1, compute how much water it is able to trap after raining.

The above elevation map is represented by array [0,1,0,2,1,0,1,3,2,1,2,1]. In this case, 6 units of rain water (blue section) are being trapped. **Thanks Marcos** for contributing this image!

**Example:**

```
Input: [0,1,0,2,1,0,1,3,2,1,2,1]
Output: 6
```

#### Analysis

é¢˜æ„ï¼š ä¸€ä¸ªæ•°ç»„ï¼Œæ¯ä¸ªæ•°å­—æ˜¯ä¸€ä¸ªbarçš„é«˜åº¦ï¼Œè¿ç»­æ’åˆ—ï¼ˆ2Då›¾å½¢ï¼‰ã€‚ é—®ï¼Œå¦‚æœä¸‹é›¨ï¼Œèƒ½å¤Ÿæˆªè·ï¼ˆè“„ï¼Œtrapï¼‰å¤šå°‘é›¨æ°´ã€‚

å…·ä½“å‚è€ƒå®Œæ•´è§£ <https://leetcode.com/problems/trapping-rain-water/solution/>

#### Solution1ï¼Œæš´åŠ›ç®—æ³•

å¯¹æ¯ä¸ªbarå•ç‹¬çœ‹ã€‚

å¦‚æœåœ¨ä¸€ä¸ªbarä¸Šèƒ½å¤Ÿè“„æ°´ï¼Œé‚£ä¹ˆè¿™ä¸ªbarå·¦å³ä¸¤ä¾§ä¸€å®šéƒ½æ¯”è¿™ä¸ªbaré«˜ã€‚

å¦‚æœä¸¤ä¾§éƒ½æœ‰æ¯”è¿™ä¸ªbaré«˜çš„barï¼Œè®°ä¸º `max_left` å’Œ `max_right`ï¼Œåˆ™è¿™ä¸ªbarä¸Šè“„æ°´çš„æ°´ä½ä¸º `min(max_left, max_right)`ï¼Œ è“„æ°´é‡ä¸º `min(max_left, max_right) - height[i]`

å› æ­¤ï¼Œå¯¹æ¯ä¸ªbarï¼Œ å‘ä¸¤è¾¹æ‰¾ `max_left` å’Œ `max_right`ï¼Œ å°†æ¯ä¸ªbarçš„è“„æ°´é‡ç´¯è®¡å³å¯ã€‚

è¿™ç§ç®—æ³•æ—¶é—´å¤æ‚åº¦ä¸º  $O(N^2)$ï¼Œ ç©ºé—´å¤æ‚åº¦ä¸º $O(1)$ã€‚åªéœ€è¦å¸¸æ•°é‡é¢å¤–ç©ºé—´ã€‚

```python
def trap(self, height):
    ans = 0
    for i in range(1, len(height) - 1):
        max_left = max_right = 0
        for j in range(i, -1, -1):
            max_left = max(max_left, height[j])
        for j in range(i, len(height)):
            max_right = max(max_right, height[j])
        ans += min(max_left, max_right) - height[i]

    return ans
```

#### Solution2ï¼Œä¼˜åŒ–

åœ¨ä¸Šé¢çš„ç®—æ³•ä¸­ï¼Œå¯¹æ¯ä¸ªbarï¼Œéƒ½è¦é‡å¤æ‰¾ä¸€æ¬¡ `max_left` å’Œ `max_right`ï¼Œæ¶ˆè€— $O(N)$ æ—¶é—´ï¼Œå…¶å®æ˜¯ä¸€ç§æµªè´¹ã€‚

å®é™…ä¸Šå¯ä»¥ä»å·¦åˆ°å³ï¼Œæ±‚å‡ºæ¯ä¸ªä½ç½®çš„barçš„ `max_left`ï¼Œå†ä»å³åˆ°å·¦ï¼Œæ±‚å‡ºæ¯ä¸ªä½ç½®çš„barçš„ `max_right`ï¼Œ ç„¶ååœ¨ä¸€æ¬¡éå†ä¸­è®¡ç®—  æ¯ä¸ªbarçš„è“„æ°´é‡ã€‚

è¿™ç§ç®—æ³•æ—¶é—´å¤æ‚åº¦ä¸º $O(N)$ï¼Œ ç©ºé—´å¤æ‚åº¦ä¸º $O(N)$

```python
def trap(self, height):

    if not height:
        return 0

    ans = 0
    max_left = [0] * len(height)
    max_right = [0] * len(height)

    max_left[0] = height[0]
    max_right[-1] = height[-1]

    for i in range(1, len(height)):
        max_left[i] = max(max_left[i - 1], height[i])
    for i in range(len(height) - 2, -1, -1):
        max_right[i] = max(max_right[i + 1], height[i])

    for i in range(1, len(height) - 1):
        ans += min(max_left[i], max_right[i]) - height[i]
    return ans
```

`max_left`æ•°ç»„ é•¿è¿™ä¸ªæ · ï¼š `[0, 0, 1, 1, 1, .., 2, 2, .., 3, 3 ...]` æ˜¯ä¸€ä¸ªå•è°ƒå¢çš„æ•°åˆ—ã€‚

`max_right`æ•°ç»„æ˜¯ä¸€ä¸ªå•è°ƒå‡çš„æ•°åˆ—ã€‚

å¦‚æœä¸æƒ³æµªè´¹å¤ªå¤šç©ºé—´ï¼Œå¯ä»¥è®°å½•æ¯ä¸ªè½¬æŠ˜ç‚¹çš„ indexå€¼ã€‚è¿™é‡Œä¸å†èµ˜è¿°ã€‚

#### Solution3ï¼ŒåŒæŒ‡é’ˆ

è¿™ä¸ªä¸æ˜¯ç‰¹åˆ«å¥½ç†è§£ï¼Œéœ€è¦ç»•ä¸ªå°å¼¯ã€‚

ä¸Šé¢çš„ç®—æ³•éå†äº†ä¸‰éæ•°ç»„ï¼Œ å¹¶ä¸”ä½¿ç”¨äº†é¢å¤–çš„ $O(N)$ ç©ºé—´ã€‚ å…¶å®ä¹Ÿå¯ä»¥åŒæŒ‡é’ˆå¤¹é€¼çš„æ–¹æ³•ï¼Œåªéå†ä¸€æ¬¡æ•°ç»„ã€‚

è¿™é‡Œçš„å…³é”®æ˜¯å¦‚ä½•ç»´æŠ¤ `max_left` å’Œ `max_right`ï¼Œä»¥åŠä½¿ç”¨å“ªä¸ªå€¼è®¡ç®—è“„æ°´é‡ã€‚ä»ç„¶æ˜¯åŸºäºç¬¬ä¸€ä¸ªç®—æ³•çš„æ€æƒ³ã€‚

- å½“ `[l] < [r]` çš„æ—¶å€™ï¼Œ
    - å¦‚æœ `[l] > max_left` åˆ™æ›´æ–° `max_left = [l]`
    - å¦åˆ™ï¼Œè®¡ç®— `l` ä½ç½®çš„è“„æ°´é‡ `= max_left - [l]`
    - æ›´æ–° `l = l + 1`ï¼Œä»å·¦å‘å³ç»§ç»­
- å½“ `[l] >= [r]` çš„æ—¶å€™
    - å¦‚æœ `[r] > max_right` åˆ™æ›´æ–° `max_right = [r]`ï¼Œ
    - å¦åˆ™ï¼Œè®¡ç®— `r` ä½ç½®çš„è“„æ°´é‡ `= max_right - [r]`
    - æ›´æ–° `r = r - 1`ï¼Œ ä»å³å‘å·¦ç»§ç»­

- åœ¨æŒ‡é’ˆç§»åŠ¨çš„æ—¶å€™ï¼Œå¯ä»¥è¯æ˜ max_left å’Œ max_right æ€»æ˜¯å¾—åˆ°æ­£ç¡®æ›´æ–°ã€‚
- è¿™ä¸ªè¿‡ç¨‹æ€»æ˜¯ä¿è¯ï¼š å¦‚æœ `[l] < [r]`ï¼Œ é‚£ä¹ˆ `[0..l] < [r]`ã€‚å› ä¸ºå¦‚æœæŸä¸ª `[i] >= [r], i = 0..l`ï¼Œ åˆ™è¿‡ç¨‹æ€»æ˜¯å…ˆä»å³è¾¹æ‰¾åˆ°ä¸€ä¸ªæ¯” `[i]` å¤§çš„ã€‚
- åŒæ ·ï¼Œå¦‚æœ `[l] >= [r]`ï¼Œé‚£ä¹ˆ `[l] >= [r...]`ã€‚ å› ä¸ºå¦‚æœæŸä¸ª `i = r...` ä½¿å¾— `[l] < [i]`ï¼Œé‚£ä¹ˆæ€»æ˜¯å…ˆä»å·¦è¾¹æ‰¾åˆ°ä¸€ä¸ªä¸å°äº `[i]`çš„ã€‚
- å› æ­¤å½“ `[l] < [r]` æ—¶ï¼Œ `max_left = max[0..l] < [r] <= max_right`
- å½“ `[l] >= [r]` æ—¶ï¼Œ `max_left >= [l] >= max[r...] = max_right`
- è¿™æ ·å°±ç¡®ä¿äº†è“„æ°´é‡è®¡ç®—çš„æ­£ç¡®æ€§ã€‚

```python
def trap(self, height):

    l, r = 0, len(height) - 1
    max_left = max_right = ans = 0

    while l < r:
        if height[l] < height[r]:
            if max_left <= height[l]:
                max_left = height[l]
            else:
                ans += max_left - height[l]
            l += 1
        else:
            if max_right <= height[r]:
                max_right = height[r]
            else:
                ans += max_right - height[r]
            r -= 1
    return ans

```

#### [Code](../python/42.%20Trapping%20Rain%20Water.py)
