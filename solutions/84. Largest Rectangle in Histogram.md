### 84. Largest Rectangle in Histogram

**Array**, **Stack**    [â¤ï¸](https://leetcode.com/problems/largest-rectangle-in-histogram)    	[ğŸ’¡](https://leetcode.com/articles/largest-rectangle-histogram)

#### Description

Given _n_ non-negative integers representing the histogram's bar height where the width of each bar is 1, find the area of largest rectangle in the histogram.

Above is a histogram where width of each bar is 1, given height = `[2,1,5,6,2,3]`.

Â 

The largest rectangle is shown in the shaded area, which has area = `10` unit.

Â 

**Example:**

```
Input: [2,1,5,6,2,3]
Output: 10
```

#### Analysis

é¢˜ç›®è¦æ±‚ï¼š æ±‚ä¸€ä¸ªç›´æ–¹å›¾ä¸­å¯ä»¥åŒ…å«çš„æœ€å¤§çš„çŸ©å½¢é¢ç§¯ã€‚ è¿™é¢˜æ˜¯æ¯”è¾ƒéš¾çš„é¢˜ç›®ï¼Œ æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„å¥—è·¯ã€‚ ä¸»è¦è€ƒå¯Ÿå¯¹äºæ•°ç»„ã€æ ˆçš„è§‚å¯Ÿå’Œç†è§£ã€‚

ä¾‹å¦‚ï¼Œä¸€ä¸ªç›´æ–¹å›¾é«˜åº¦ä¸º : `[2, 1, 5, 6, 2, 3]`ï¼Œ æœ€å¤§é¢ç§¯åŒ…å«åœ¨ `[5, 6]` ä¸¤æŸ±ï¼ˆbarï¼‰ä¸Šï¼Œ ä¸º 10ã€‚

##### Solution1

ä¸€ç§å¸¸è§„çš„æ€è·¯æ˜¯ï¼Œ å¯¹æ¯ä¸ª barï¼Œ ä»å…¶é¡¶éƒ¨å‘ä¸¤è¾¹å»¶ä¼¸ï¼Œæ‰¾å¯ä»¥èƒ½åˆ°è¾¾çš„æœ€å®½è¾¹ç•Œã€‚å°†å®½ä¹˜ä»¥baré«˜ï¼Œæ˜¯ä»¥è¿™ä¸ªbaré«˜ä¸ºçŸ©å½¢é«˜çš„æœ€å¤§é¢ç§¯ã€‚ å¯¹æ¯ä¸ªbarè®¡ç®—ä¸€æ¬¡ï¼Œæ‰¾åˆ°æœ€å¤§é¢ç§¯å³ä¸ºç­”æ¡ˆã€‚ ä½†æ˜¯ç”±äºæ¯ä¸ª bar éå†äº†ä¸€éæ•°ç»„ï¼Œ ç®—æ³•æ—¶é—´å¤æ‚åº¦ä¸º $O(N^2)$

```python
def largestRectangleArea(self, heights):
    max_area = 0
    for i, h in enumerate(heights):
        # find left
        l = i - 1
        while l >= 0 and heights[l] >= heights[i]:
            l -= 1
        l += 1

        # find right
        r = i + 1
        while r < len(heights) and heights[i] <= heights[r]:
            r += 1

        max_area = max(max_area, h * (r - l))

    return max_area
```

##### Solution2

ä¸Šé¢è¿‡ç¨‹å¯ä»¥ä¼˜åŒ–ã€‚ æ‰¾è¾¹ç•Œä¸ç”¨éå†æ•°ç»„ã€‚ è€ƒè™‘è‹¥å¹²æƒ…å†µï¼Œä»å·¦å‘å³ä¾æ¬¡æ‰¾åˆ°æ¯ä¸ªbarçš„å·¦è¾¹ç•Œï¼Œ è®°ä¸º `left`ï¼š

1. `[1, 2, 3, 4, 5]`ï¼Œ ç¬¬0ä¸ªbarå·¦è¾¹ç•Œä¸º 0ï¼› ç¬¬ `i` ä¸ªbarï¼Œçœ‹å‰ä¸€ä¸ªä½ç½®ï¼Œå¦‚æœå‰ä¸€ä¸ªä½ç½®çš„baré«˜æ¯”è‡ªå·±å°ï¼Œ é‚£ä¹ˆå·¦è¾¹ç•Œå°±æ˜¯è‡ªå·±çš„ç´¢å¼•ã€‚ å› æ­¤å·¦è¾¹ç•Œä¾æ¬¡æ˜¯ï¼š `[0, 1, 2, 3, 4]`ã€‚ è¿™ç§æƒ…å†µæ¯ä¸ªä½ç½®ä¹‹æŸ¥æ‰¾äº† 1æ­¥ã€‚
2. `[5, 4, 3, 2, 1]`ï¼Œ ç¬¬0ä¸ªbarå·¦è¾¹ç•Œä¸º 0ï¼› ç¬¬ `i` ä¸ªbarï¼Œçœ‹å‰ä¸€ä¸ªä½ç½®çš„ `i - 1`ï¼Œå¦‚æœæ¯”è‡ªå·±é«˜ï¼Œé‚£ä¹ˆ **ä» `i` å¯ä»¥å»¶ä¼¸åˆ° `i-1` çš„å·¦è¾¹ç•Œä¹Ÿæ²¡é—®é¢˜**ï¼Œ å› æ­¤ä» `left[i-1] - 1` ä½ç½®ç»§ç»­å¯»æ‰¾è¾¹ç•Œã€‚ å› æ­¤å·¦è¾¹ç•Œä¾æ¬¡æ˜¯ï¼š `[0, 0, 0, 0, 0]`ï¼Œ å¯ä»¥çœ‹å‡ºæ¥ï¼Œæ¯ä¸ªä½ç½®å®é™…ä¸ŠåªæŸ¥æ‰¾äº†2æ­¥ã€‚
3. `[2, 1, 5, 6, 2, 3]`ï¼Œ ç»¼åˆæƒ…å†µã€‚ æŒ‰ä¸Šé¢çš„æ–¹å¼æŸ¥æ‰¾å·¦è¾¹ç•Œï¼Œä¾æ¬¡æ˜¯ ï¼š `[0, 0, 2, 3, 2, 5]`ï¼Œ å…¶ä¸­åªæœ‰åœ¨ç¬¬ 4ä¸ª `bar = 2`ï¼Œ å¾€å›æŸ¥æ‰¾äº†3æ­¥ã€‚

ä¸€ç§æœ€éº»çƒ¦çš„æƒ…å†µæ˜¯ï¼š `[2, 3, 4, 5, 6, 7, 8, 9, 1]`ï¼Œ åœ¨æŸ¥æ‰¾æœ€åä¸€ä¸ªbarçš„å·¦è¾¹ç•Œçš„æ—¶å€™ï¼Œè¦éå†ä¸€éå‰é¢æ‰€æœ‰çš„barã€‚ ä¹‹æ‰€ä»¥ç§°ä¸ºæœ€éº»çƒ¦è€Œä¸æ˜¯æœ€åï¼Œæ˜¯å› ä¸ºå‰é¢æ‰€æœ‰ baræŸ¥æ‰¾å·¦è¾¹ç•Œéƒ½åªéœ€è¦ä¸€æ­¥ã€‚ å¦‚æœç”¨å‡æ‘Šæ—¶é—´æ¥è¯„ä¼°è¿™ä¸ªæŸ¥æ‰¾è¿‡ç¨‹ï¼Œå‡æ‘Šæ—¶é—´æ˜¯ $O(1)$ã€‚

è¯æ˜ï¼š æ¯ä¸ªbar æœ€å¤šåªè¢«â€œè®¿é—®â€ åˆ° 2æ¬¡ï¼š ç¬¬ä¸€æ¬¡æ˜¯éå†åˆ°ï¼Œæ‰¾å·¦è¾¹ç•Œï¼Œæ‰¾åˆ°åæŠŠå·¦è¾¹ç•Œç´¢å¼•è®°å½•ä¸‹æ¥ï¼› ç¬¬äºŒæ¬¡æ˜¯å½“åé¢å‡ºç°ç¬¬ä¸€ä¸ªæ¯”è‡ªå·±å°çš„ barï¼ˆå‡è®¾ä½ç½®ä¸ºjï¼‰çš„æ—¶å€™ï¼Œåœ¨æŸ¥æ‰¾è¾¹ç•Œçš„è¿‡ç¨‹ä¸­ï¼Œä¼šä½¿ç”¨è‡ªå·±çš„è¾¹ç•Œï¼ˆå®é™…ä¸Šå°±æ˜¯è‡ªå·±çš„ç´¢å¼•ï¼‰å‘å·¦ç»§ç»­æŸ¥æ‰¾ã€‚ åœ¨æ­¤ä¹‹åï¼Œ è¿™ä¸ªbarï¼ˆè®¾ä½ç½®ä¸º iï¼‰å°±ä¸ä¼šå†è®¿é—®åˆ°äº†ï¼š å¦‚æœ j ä¹‹åçš„bar æ¯” `bar[j]` é«˜ï¼Œ åˆ™ä¸ä¼šç”¨åˆ° `bar[j]` çš„å·¦è¾¹ç•Œã€‚ å¦‚æœ j ä¹‹åçš„ bar æ¯” `bar[j]` ä½ï¼Œ åˆ™å¯ä»¥ç›´æ¥é€šè¿‡ `bar[j]` è·³åˆ° `bar[j]` çš„å·¦è¾¹ç•Œï¼ˆè¶Šè¿‡äº† iï¼‰ã€‚

å®é™…ä¸Šè¿˜å¯ä»¥ç”¨æ ˆçš„æ€æƒ³å®ç°å’Œè¯æ˜è¿™ä¸ªæ€è·¯ã€‚

1. å¦‚æœæ ˆä¸ºç©ºï¼Œ æˆ–è€… bar æ¯”æ ˆé¡¶ç´¢å¼•çš„baré«˜ï¼ˆæˆ–ç›¸åŒï¼‰ï¼Œ åˆ™å°†å½“å‰barç´¢å¼•å‹å…¥æ ˆä¸­ã€‚
2. å¦‚æœbar æ¯”æ ˆé¡¶ç´¢å¼•çš„barä½ï¼Œ ä¾æ¬¡å¼¹å‡ºæ ˆé¡¶å…ƒç´ ï¼Œç›´åˆ°å‘ç°ä¸ä½äºæ ˆé¡¶ç´¢å¼•barï¼Œç„¶åå°†å½“å‰barç´¢å¼•å‹å…¥æ ˆä¸­ã€‚

è§‚å¯Ÿè¿™ä¸ªæ ˆï¼Œä¼šå‘ç°è¿™æ ·å‡ ä¸ªç‰¹ç‚¹ï¼š

1. æ ˆä¸­barçš„é«˜åº¦æ˜¯å•è°ƒé€’å¢çš„ï¼ˆ `<=`ï¼‰ã€‚
2. **æ ˆä¸­æ¯ä¸ªbarçš„å·¦è¾¹ç•Œç­‰äºæ ˆä¸­å‰ä¸€ä¸ªbarçš„ç´¢å¼• + 1**ï¼Œ å½¢å¼è¡¨ç¤ºå°±æ˜¯ `left[stack[i]] = stack[i-1] + 1`

å¯ä»¥çœ‹å‡ºï¼Œä¸¤ç§æ–¹æ³•ä¸€å®šç¨‹åº¦ä¸Šæ˜¯ç›¸åŒçš„ï¼š åœ¨æŸ¥æ‰¾å·¦è¾¹ç•Œçš„è¿‡ç¨‹ä¸­ï¼Œä¼šå¼ƒæ‰ä¹‹å‰æ¯”å½“å‰ bar é«˜çš„ æ‰€æœ‰barçš„ä¿¡æ¯ï¼š **åé¢çš„ä»»æ„bar éƒ½ä¸ä¼šç”¨åˆ°è¿™äº›ä¿¡æ¯ï¼Œå› ä¸ºè¢«å½“å‰baré™åˆ¶ä½äº†**ã€‚ æ¯ä»½ä¿¡æ¯åªä½¿ç”¨è¿‡ä¸¤æ¬¡ï¼šç¬¬ä¸€æ¬¡è·å–ï¼Œç¬¬äºŒæ¬¡å¼ƒæ‰ã€‚

å³è¾¹ç•ŒåŒç†ã€‚

```python
def largestRectangleArea(self, heights):
    n = len(heights)
    left = [0] * n
    right = [n] * n

    for i in range(1, n):
        p = i - 1
        h = heights[i]
        while p >= 0 and heights[p] >= h:
            p = left[p] - 1
        left[i] = p + 1

    for i in range(n - 2, -1, -1):
        p = i + 1
        h = heights[i]
        while p < n and heights[p] >= h:
            p = right[p]
        right[i] = p

    ans = 0
    for i in range(n):
        ans = max(ans, heights[i] * (right[i] - left[i]))
```

##### Solution3

è¿˜å¯ä»¥ç”¨ä¸Šé¢æ ˆçš„æ€è·¯ï¼Œéå†ä¸€æ¬¡è§£å†³è¿™ä¸ªé—®é¢˜ï¼š

```python
def largestRectangleArea(self, heights):
    max_area = 0
    heights.append(0)
    stack = []
    for i in range(len(heights)):
        while stack and heights[stack[-1]] > heights[i]:
            h = heights[stack.pop()]
            w = i - stack[-1] - 1 if stack else i
            max_area = max(max_area, h * w)
        stack.append(i)
    return max_area
```

ä¸»è¦è§£é‡Šå‡ ç‚¹ï¼š

1. `while stack and heights[stack[-1]] > heights[i]` å°±æ˜¯ä¸€ä¸ªä»æ ˆä¸­æ‰¾æ¯”å½“å‰é«˜åº¦å°çš„è¿‡ç¨‹ã€‚
2. æ³¨æ„åœ¨å¼¹å‡ºæ ˆé¡¶å…ƒç´ çš„æ—¶å€™ï¼Œå¯ä»¥åŒæ—¶çŸ¥é“æ ˆé¡¶barçš„å·¦å³è¾¹ç•Œï¼š
    1. å·¦è¾¹ç•Œï¼š å¦‚æœ `len(stack) > 1`ï¼Œ åˆ™ `left[stack[-1]] = stack[-2] + 1`
    2. å·¦è¾¹ç•Œï¼Œ å¦‚æœ `len(stack) == 1`ï¼Œ åˆ™ `left[stack[-1]] = 0`ã€‚ è¿™ç§æƒ…å†µæ¯”è¾ƒç‰¹æ®Šã€‚å®ƒè¡¨ç¤ºå¦‚æœ æ ˆä¸­åªæœ‰ä¸€ä¸ªç´¢å¼•ï¼Œåˆ™è¿™ä¸ªç´¢å¼•å¯¹åº”barçš„å·¦è¾¹ç•Œå®é™…ä¸Šæ˜¯0ï¼š å³å¯ä»¥ä»baré¡¶å»¶ä¼¸åˆ°ä½ç½® 0ã€‚
    3. å³è¾¹ç•Œï¼š å¾ˆç®€å•ï¼Œç»å¯¹æ˜¯  `i` å•¦ã€‚
3.  `h = heights[stack.pop()], w = i - stack[-1] - 1 if stack else i`
4.  å°±å¯ä»¥æ±‚å‡ºé¢ç§¯ã€‚

ä¸ºäº†é¿å…æœ€åæ ˆéç©ºï¼Œ åœ¨ heightsåé¢åŠ ä¸Šä¸€ä¸ª `sentinel = 0`  ã€‚ç”¨äºåœ¨æœ€åä½ç½®å°† stack æ¸…ç©ºï¼ˆå› ä¸ºæ‰€æœ‰é«˜åº¦éƒ½æ˜¯éè´Ÿå€¼ï¼‰ã€‚è¿™ç§å†™æ³•æ¯”è¾ƒä¼˜é›…ã€‚


##### Solution4

è¿˜æœ‰ä¸€ç§æ€è·¯æ˜¯ åˆ†æ²»æ³•ã€‚å…¶ä¸»è¦æ€æƒ³æ˜¯ï¼š å…ˆç”¨ $O(N)$ æ—¶é—´æ„é€ ä¸€ä¸ªæ ‘ï¼Œ æ¯æ¬¡ç”¨ $O(\log N)$ æ—¶é—´å¯ä»¥æ‰¾åˆ°æœ€å°å€¼ã€‚

æ‰¾åˆ°æœ€å°å€¼åŠå…¶ç´¢å¼•ä¹‹åï¼Œ æœ€å¤§é¢ç§¯æ˜¯ä¸‰ä¸ªå€¼çš„æœ€å¤§å€¼ï¼š

- æœ€å°å€¼å·¦è¾¹éƒ¨åˆ†çš„æœ€å¤§é¢ç§¯ï¼ˆå­é—®é¢˜ $T(N/2)$ï¼‰
- æœ€å°å€¼å³è¾¹éƒ¨åˆ†çš„æœ€å¤§é¢ç§¯ï¼ˆå­é—®é¢˜ $T(N/2)$ï¼‰
- æœ€å°å€¼ x å®½åº¦ï¼ˆé—®é¢˜èŒƒå›´ï¼‰

å¦‚æœç”¨ $O(\log N)$ å¯ä»¥æ‰¾åˆ°æœ€å°å€¼ï¼Œé‚£ä¹ˆæ€»çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ $O(N\log N)$ã€‚ ä¸ä»…éº»çƒ¦ï¼Œè€Œä¸”æ…¢ã€‚


##### Reference

- [Solution2](https://leetcode.com/problems/largest-rectangle-in-histogram/discuss/29002/My-C++-DP-solution-16ms-easy-to-understand!)
- [Solution3](https://www.geeksforgeeks.org/largest-rectangle-under-histogram/)
- [Solution4](https://www.geeksforgeeks.org/largest-rectangular-area-in-a-histogram-set-1/)



#### [Code](../python/84.%20Largest%20Rectangle%20in%20Histogram.py)
